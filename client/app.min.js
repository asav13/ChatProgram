var myApp=angular.module("chatApp",["ngRoute","ui.bootstrap"]);myApp.controller("LayoutController",["$scope","$location","$rootScope",function(o,t,l){o.navbarCollapsed=!0,l.go=function(o){t.path(o)}}]),myApp.config(["$routeProvider",function(o){o.when("/",{templateUrl:"src/home/home.html",controller:"HomeController"}).when("/login",{templateUrl:"src/login/login.html",controller:"LoginController"}).when("/chatrooms",{templateUrl:"src/chat/chatstartup.html",controller:"ChatController"}).when("/chatrooms/:name",{templateUrl:"src/chat/chatrooms.html",controller:"ChatRoomController"}).otherwise({templateUrl:"src/home/home.html"})}]);
"use strict";angular.module("chatApp").controller("ChatController",["$scope","$rootScope","$routeParams","$location","ChatResource","UserService",function(o,e,n,r,s,t){o.online=t.getOnlineStatus(),o.joinError=!1,o.isCollapsed=!0,s.getRoomList(),o.online||r.path("/login"),s.on("roomlist",function(e){if(e){var n=[];for(var r in e){var s={name:r,room:r,topic:e[r].topic,users:e[r].users,userCount:Object.keys(e[r].users).length,ops:e[r].ops};n.push(s)}o.rooms=n,o.selectedRoom=o.rooms[0]}}),s.on("updatechat",function(o,e){s.getRoomList()}),s.on("updateusers",function(o,n){if(t.getOnlineStatus()){var r=t.getUserRoom();null!==r&&r.name===o&&(s.getRoomUsers(o.toString()),s.on("roomUserlist",function(o,n){o&&(e.joinedRoom.users=o)}))}}),o.createRoom=function(){var n=t.getUsername(),i={userName:n};if(void 0!==o.newRoomName){var m={room:o.newRoomName,name:o.newRoomName,topic:"No topic has been set for room..",ops:i};s.createRoom(m).then(function(n,i){n&&(o.joinError=!1,e.joinedRoom=m,r.path("/chatrooms/"+m.name),s.getMessages(m.name),t.addRoom(m),t.addOpRoom(m))})}},o.join=function(n){o.selectedRoom=n;var i=o.selectedRoom;({room:o.selectedRoom});s.joinRoom(i).then(function(n){n?(s.getRoomList(),o.joinError=!1,e.joinedRoom=i,r.path("/chatrooms/"+i.room),t.addRoom(i)):o.joinError=!0})},s.on("roomUserlist",function(o){void 0===e.joinedRoom.users&&(e.joinedRoom.users={});for(var n in o)e.joinedRoom.users[n]=n}),s.on("roomoplist",function(o){void 0===e.joinedRoom.users&&(e.joinedRoom.users={}),void 0===e.joinedRoom.ops&&(e.joinedRoom.ops={}),e.joinedRoom.ops=o;for(var n in o)e.joinedRoom.users[n]=n})}]);
"use strict";angular.module("chatApp").controller("ChatRoomController",["$scope","$rootScope","$routeParams","$location","ChatResource","UserService",function(e,o,n,s,t,r){e.online=r.getOnlineStatus(),e.myName=r.getUsername(),e.selectedUser="",e.someOneSelected=!1,e.isOp=!1,e.newMsg=!1,e.unbanning=!1,e["public"]=!0,e["private"]=!1,e.roomMessages={},e.usersUserIsChattingTo=[],e.tabs=[],e.privateMessages=[];var a=r.getUserRoom();e.online?(t.getMessages(e.joinedRoom.room),t.getRoomUsers(e.joinedRoom.room)):s.path("/login"),e.setSelectedUser=function(o){if(void 0!==o){var n={};n[o]=o,e.selectedUser=o,e.someOneSelected=!0;for(var s=0;s<e.tabs.length;s++)e.tabs[s].title===e.selectedUser&&(e.tabs[s].unread="")}""!==e.selectedUser?(e["private"]=!0,e["public"]=!1):(e["private"]=!1,e["public"]=!0)},e.setSelectedUserNone=function(){e["public"]=!0,e["private"]=!1,e.selectedUser=""},e.leaveRoom=function(){var e=n.name;a=null,t.leaveRoom(e),s.path("/chatrooms"),r.leaveRoom()},null!==a&&o.$on("$routeChangeSuccess",function(e,o,n){if("/chatrooms"!==s.hash&&null!==a){var i=a.name;t.leaveRoom(i),s.path("/chatrooms"),r.leaveRoom(),a=null}}),e.sendMessage=function(){var o=e.chatInput;if(o.length>0){var s=n.name,r=(new Date,{roomName:s,msg:o});e.chatInput="",t.sendMsg(r)}},e.sendPrivateMessage=function(){var o,n,s=e.selectedUser,a=e.pmInput,i=new Date;if(i=i.toString(),i=i.substring(16,24),null!==a){o={nick:s,message:a},n={nick:r.getUsername(),message:a};var m={from:r.getUsername(),to:s,message:a};e.privateMessages.push(m);var c={from:r.getUsername(),time:i,message:a};if(e.usersUserIsChattingTo.indexOf(o.nick)<0){e.usersUserIsChattingTo.push(s);var u={title:s,content:[c],unread:""};e.tabs.push(u)}else for(var g=0;g<e.tabs.length;g++)e.tabs[g].title===s&&(e.tabs[g].unread="",e.tabs[g].content.push(c))}e.pmInput="",t.sendPrivateMsg(o,function(e){}),t.sendPrivateMsg(n,function(e){})},t.on("updatechat",function(e,o){t.getMessages(e),t.getRoomUsers(e)}),t.on("recv_privatemsg",function(o,n){if(o[1]){e.newMsgFrom=o[0],t.getPrivateMessages(o);var s=new Date;s=s.toString(),s=s.substring(16,24);var a={from:o[0],msg:o[1],time:s};if(a.from!==r.getUsername()){var i={from:a.from,time:a.time,message:a.msg};if(e.usersUserIsChattingTo.indexOf(a.from)<0){e.usersUserIsChattingTo.push(a.from),e.newMsg=!0,setTimeout(function(){e.newMsg=!1},150);var m={title:a.from,content:[i],unread:"(!)"};e.tabs.push(m)}else for(var c=0;c<e.tabs.length;c++)e.tabs[c].title===a.from&&(e.tabs[c].unread="(!)",e.tabs[c].content.push(i))}}}),t.on("roommessageslist",function(n){if(n&&null!==r.getUserRoom){var s=n[1];if(n[0]===r.getUserRoom().room&&s){for(var t=0;t<s.length;t++)s[t].time=s[t].timestamp.substring(11,19);var a=r.getUserRoom();o.joinedRoom=a,e.roomMessages[a]=s}}}),t.on("kicked",function(e,o){e[1]===r.getUsername()&&s.path("/chatrooms")}),t.on("banned",function(e){e[1]===r.getUsername()&&s.path("/chatrooms")}),t.on("opped",function(n){if(n[1]===r.getUsername()){e.isOp=!0;var s=o.joinedRoom;r.addOpRoom(s)}}),t.on("deopped",function(o){o[1]===r.getUsername()&&(e.isOp=!1,r.removeOpRoom())}),t.on("roomUserlist",function(e){void 0===o.joinedRoom.users&&(o.joinedRoom.users={});for(var n in e)o.joinedRoom.users[n]=n}),t.on("roomoplist",function(e){void 0===o.joinedRoom.users&&(o.joinedRoom.users={}),void 0===o.joinedRoom.ops&&(o.joinedRoom.ops={}),o.joinedRoom.ops=e;for(var n in e)o.joinedRoom.users[n]=n}),e.changeTopic=function(){if(void 0!==e.changedTopic&&""!==e.changedTopic){var n={room:a.name,topic:e.changedTopic};t.setTopic(n).then(function(s,t){s&&(o.joinedRoom.topic=n.topic,e.changedTopic="")})}},e.$watch("selectedUser",function(){var o=r.getUsername();e.someOneSelected=!0,null!==r.getOpRoom()&&(e.isOp=!0),e.selectedUser===o&&(e.someOneSelected=!1,e.isOp=!1,e.selectedUser="")}),e.kick=function(){var o={user:e.selectedUser,room:n.name};t.kick(o,function(e){})},e.ban=function(){var o={user:e.selectedUser,room:n.name};t.ban(o,function(e){})},e.makeOp=function(){var o={user:e.selectedUser,room:n.name};t.makeOp(o,function(e){t.getRoomUsers(o.room)})},e.deOp=function(){var o={user:e.selectedUser,room:n.name};t.deOp(o,function(e){t.getRoomUsers(o.room)})},e.unban=function(){e.unbanning=!0,e.confirmUnban=function(){var o=e.unbanusername,s={user:o,room:n.name};t.unban(s,function(e){}),e.unbanning=!1}}}]);
"use strict";angular.module("chatApp").controller("HomeController",["$scope","$location","ChatResource","UserService","$rootScope",function(o,s,r,e,n){o.online=e.getOnlineStatus(),o.rooms=[],o.users=[],o.showDiv=!1,o.userLimit=20,r.getRoomList(),r.on("roomlist",function(s){if(s){var r=[],e=0;for(var n in s){e++;var t=[],u={name:n,users:""};for(var i in s[n].users)t.push(" "+s[n].users[i]);angular.equals({},s[n].users)?u.users="Nobody here...":u.users=t.toString(),r.push(u)}e>=6&&(o.showDiv=!0),o.rooms=r}else console.log("ERROR: Error fetching rooms.")}),r.getUsers(),r.on("userlist",function(s){s?o.users=s:console.log("ERROR: Error fetching users.")})}]);
"use strict";angular.module("chatApp").controller("LoginController",["$scope","$location","ChatResource","UserService",function(o,n,e,l){o.logininfo="",o.online=l.getOnlineStatus(),o.rooms=[],o.login=function(){e.login(o.username).then(function(e){e?(l.login(o.username),o.logininfo="Welcome "+o.username+"!",o.online=!0,n.path("/chatrooms")):o.logininfo="Username '"+o.username+"' not available."})},o.logout=function(){l.logout(),e.logout(),o.online=!1,n.path("/")}}]);
"use strict";angular.module("chatApp").factory("ChatResource",["$rootScope","$q",function(n,o){var t=io.connect("http://localhost:8080");return{login:function(e){var i=o.defer();return n.username=e,n.login=!0,t.emit("adduser",e,function(n){i.resolve(n)}),i.promise},logout:function(){t.emit("logout")},getRoomList:function(n){t.emit("rooms")},getRoomUsers:function(n){t.emit("roomUsers",n)},getMessages:function(n){t.emit("roomMessages",n)},getPrivateMessages:function(n,o){t.emit("roomPrivateMessages",n,function(n,o){})},getUsers:function(n){t.emit("users",function(n){})},createRoom:function(n){var e=o.defer();return t.emit("joinroom",n,function(n,o){e.resolve(n)}),e.promise},joinRoom:function(n){var e={room:n.name},i=o.defer();return t.emit("joinroom",e,function(n,o){i.resolve(n)}),i.promise},leaveRoom:function(n){t.emit("partroom",n)},setTopic:function(n,e){var i=o.defer();return t.emit("settopic",n,function(n,o){i.resolve(n)}),i.promise},sendMsg:function(n){t.emit("sendmsg",n)},sendPrivateMsg:function(o,e){t.emit("privatemsg",o,function(o){n.$apply(function(){e.apply(t,[o])})})},kick:function(o,e){t.emit("kick",o,function(o){n.$apply(function(){e.apply(t,[o])})})},ban:function(o,e){t.emit("ban",o,function(o){n.$apply(function(){e.apply(t,[o])})})},unban:function(o,e){t.emit("unban",o,function(o){n.$apply(function(){e.apply(t,[o])})})},makeOp:function(o,e){t.emit("op",o,function(o){n.$apply(function(){e.apply(t,[o])})})},deOp:function(o,e){t.emit("deop",o,function(o){n.$apply(function(){e.apply(t,[o])})})},on:function(e,i){o.defer();t.on(e,function(o,e,u){n.$apply(function(){i.apply(t,[o])})})}}}]);
"use strict";angular.module("chatApp").factory("UserService",function(){var o={name:null,room:null,opRoom:null},n=!1;return{login:function(u){void 0===u||n||(o.name=u,o.rooms=[],n=!0)},getUsername:function(){return o.name},getUserRoom:function(){return o.room},getOnlineStatus:function(){return n},logout:function(){n&&(n=!1,o.name=null,o.room=null,o.opRoom=null)},addRoom:function(u){n&&(o.room=u)},leaveRoom:function(u){n&&(o.room=null,o.opRoom=null)},addOpRoom:function(n){o.opRoom=n},getOpRoom:function(n){return o.opRoom},removeOpRoom:function(){o.opRoom=null}}});